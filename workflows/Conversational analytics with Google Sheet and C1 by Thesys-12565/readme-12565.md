Conversational analytics with Google Sheet and C1 by Thesys

https://n8nworkflows.xyz/workflows/conversational-analytics-with-google-sheet-and-c1-by-thesys-12565


# Conversational analytics with Google Sheet and C1 by Thesys

disclaimer Le texte fourni provient exclusivement d’un workflow automatisé réalisé avec n8n, un outil d’intégration et d’automatisation. Ce traitement respecte strictement les politiques de contenu en vigueur et ne contient aucun élément illégal, offensant ou protégé. Toutes les données manipulées sont légales et publiques.

## 1. Workflow Overview

**Title:** Conversational analytics with Google Sheet and C1 by Thesys  
**Workflow name (n8n):** `talk-to-your-data`  
**Purpose:** Provide a chat interface where a user can ask natural-language questions about data stored in a Google Sheet, and receive **interactive UI outputs** (charts/tables/components) generated by **C1 by Thesys** rather than plain text answers.

**Primary use cases:**
- Conversational reporting on spreadsheet data (leads, marketing performance, operations metrics)
- Replacing manual pivot tables/filters with chat-driven exploration
- Returning structured “UI schema” responses consumable by a frontend (Thesys GenUI SDK)

### Logical Blocks
**1.1 Chat Entry & Session Start**
- Receives user messages via an n8n public chat endpoint.

**1.2 AI Agent Orchestration (UI-first)**
- An AI Agent that can reason, call tools, and produce UI-oriented structured responses.

**1.3 Data Access Tooling**
- A Google Sheets “tool” node that the agent can invoke to fetch spreadsheet data.

**1.4 Model + Memory**
- A Thesys/C1-backed chat model for generation.
- A windowed memory buffer to keep conversation context across turns.

**1.5 Documentation / Setup Guidance (Sticky Notes)**
- Several sticky notes provide setup steps, links, and visuals (non-executable).

---

## 2. Block-by-Block Analysis

### Block 1.1 — Chat Entry & Session Start
**Overview:** Exposes a public chat webhook so end users (or a Thesys-hosted frontend) can send prompts into the workflow. The message becomes the input to the UI Agent.

**Nodes involved:**
- **When chat message received**

#### Node: When chat message received
- **Type / role:** `@n8n/n8n-nodes-langchain.chatTrigger` (Chat Trigger). Entry point that starts executions on each incoming chat message.
- **Key configuration choices:**
  - **Public:** enabled (`public: true`) so the chat URL can be used externally.
  - **Initial messages:** empty (no system greeting injected here).
  - **Webhook ID:** present (`89831acd-...`) — n8n uses this internally to route requests.
- **Inputs / outputs:**
  - **Output (main):** connected to **UI Agent** (main input).
- **Version-specific notes:** typeVersion `1.4` (behavior depends on n8n’s LangChain integration; ensure your n8n version supports Chat Trigger nodes).
- **Edge cases / failures:**
  - If the workflow is **inactive**, the public chat endpoint won’t respond as expected.
  - If deployed behind auth/proxy restrictions, “public” accessibility may still be blocked.
  - Very large messages can hit platform payload limits; streaming is handled later by the agent.

---

### Block 1.2 — AI Agent Orchestration (UI-first)
**Overview:** The UI Agent is the central brain. It receives the user message, uses the Google Sheets tool when needed, relies on memory for context, and generates a UI-oriented response using the C1 Chat Model.

**Nodes involved:**
- **UI Agent**

#### Node: UI Agent
- **Type / role:** `@n8n/n8n-nodes-langchain.agent` (Agent). Orchestrates tool calls + model inference to answer user prompts.
- **Key configuration choices:**
  - **Streaming enabled:** `options.enableStreaming: true` to stream the model output where supported (useful for responsive UI).
- **Key expressions / variables:**
  - No explicit expressions configured in this node; it depends on connected AI inputs (model/memory/tools).
- **Inputs / outputs (by connection type):**
  - **Main input:** from **When chat message received**
  - **AI language model input:** from **C1 Chat Model**
  - **AI memory input:** from **Simple Memory**
  - **AI tool input:** from **Fetch data from Google Sheet**
  - Output is the agent’s final response to the chat execution (not explicitly connected to another node in this workflow JSON; Chat Trigger/agent pairing typically returns to the chat channel automatically).
- **Version-specific notes:** typeVersion `3`. Ensure your n8n build supports the Agent node v3 and streaming option.
- **Edge cases / failures:**
  - If the model credentials/base URL are wrong, the agent fails at generation time.
  - If the tool returns unexpected data shapes (empty sheet, missing headers), the agent may generate incorrect UI schema or fail to answer.
  - Streaming may not work if the upstream model/provider or n8n environment doesn’t support it; fallback is non-streamed completion.

---

### Block 1.3 — Data Access Tooling (Google Sheets)
**Overview:** Provides a Google Sheets “tool” the agent can invoke to fetch spreadsheet content for analysis. This is how the agent grounds answers in your sheet data.

**Nodes involved:**
- **Fetch data from Google Sheet**

#### Node: Fetch data from Google Sheet
- **Type / role:** `n8n-nodes-base.googleSheetsTool` (AI Tool). Exposes Google Sheets access as a callable tool for the agent.
- **Key configuration choices (interpreted):**
  - **Target document:** Google Sheet named (cached) **“Lead Gen”** with ID `1wRKn53iDhDCUzvkaYjmhDZQJn13gMZIJ0o_MjBFJ5mU`.
  - **Target sheet/tab:** `gid=0` (cached name **“Sheet1”**).
  - **Options:** defaults (no extra filters/ranges specified in the provided config).
  - This node is configured as a **tool**, meaning the agent decides when to call it and with what query parameters (within the node’s supported operations).
- **Credentials:**
  - **Google Sheets OAuth2** credential `Google Sheets account 2`.
- **Inputs / outputs:**
  - **AI tool output:** connected to **UI Agent** as an available tool.
- **Version-specific notes:** typeVersion `4.7`. Requires an n8n version that includes `googleSheetsTool` (distinct from standard Google Sheets nodes).
- **Edge cases / failures:**
  - OAuth token expiration / revoked access.
  - Permission issues (sheet not shared with the OAuth account).
  - Sheet structure problems (merged cells, missing headers, inconsistent datatypes) can degrade agent reliability.
  - Large sheets may cause slow reads/timeouts or exceed tool limits depending on implementation.

---

### Block 1.4 — Model + Memory
**Overview:** Supplies the agent with (a) a chat model endpoint using Thesys “C1” routing and (b) a windowed memory buffer to preserve recent conversation turns.

**Nodes involved:**
- **C1 Chat Model**
- **Simple Memory**

#### Node: C1 Chat Model
- **Type / role:** `@n8n/n8n-nodes-langchain.lmChatOpenAi` (Chat LLM connector). Despite the name, it’s used here with a **Thesys C1 model identifier**, typically by pointing OpenAI-compatible credentials to Thesys’ OpenAI-style endpoint.
- **Key configuration choices:**
  - **Model:** `c1/openai/gpt-5/v-20250930` (selected from a list).
  - **Responses API:** disabled (`responsesApiEnabled: false`), so it likely uses standard chat-completions style.
  - **Other options:** default/empty.
- **Credentials (critical):**
  - Uses an `openAiApi` credential named **“OpenAi account 2”**.
  - The sticky notes indicate you must set the credential **Base URL** to: `https://api.thesys.dev/v1/embed` and use a **Thesys API key** (even though the credential type is “OpenAI API”).
- **Inputs / outputs:**
  - **AI language model output:** connected to **UI Agent**.
- **Version-specific notes:** typeVersion `1.3`. Compatibility depends on n8n’s LangChain OpenAI chat model node version.
- **Edge cases / failures:**
  - Wrong Base URL (still pointing to OpenAI) → model ID won’t resolve / auth fails.
  - Wrong/expired Thesys API key → 401/403.
  - Model name/version mismatch → 404 or provider error.
  - Provider rate limits or transient 5xx errors.

#### Node: Simple Memory
- **Type / role:** `@n8n/n8n-nodes-langchain.memoryBufferWindow` (Conversation memory). Keeps a rolling window of recent messages.
- **Key configuration choices:**
  - No parameters set in JSON, so defaults apply (typically: a fixed number of last turns; exact default depends on node version).
- **Inputs / outputs:**
  - **AI memory output:** connected to **UI Agent**.
- **Version-specific notes:** typeVersion `1.3`.
- **Edge cases / failures:**
  - If defaults store too few turns, context may be lost quickly.
  - If configured too large (not shown here), prompt size/token usage may grow and increase cost/latency.

---

### Block 1.5 — Documentation / Setup Guidance (Sticky Notes)
**Overview:** These nodes contain only explanatory content, links, and images. They do not affect execution but are essential for correct setup and intended usage.

**Nodes involved:**
- **Sticky Note**
- **Sticky Note1**
- **Sticky Note2**
- **Sticky Note6**
- **Sticky Note8**

#### Node: Sticky Note
- **Type / role:** `n8n-nodes-base.stickyNote` (Documentation panel).
- **Content highlights:**
  - Explains the concept and use cases.
  - Links:
    - Working demo: https://www.thesys.dev/n8n?url=https%3A%2F%2Fasd2224.app.n8n.cloud%2Fwebhook%2Feb721104-ff1e-43f2-800d-000f04c1f427%2Fchat
    - Get API key: https://console.thesys.dev/keys
    - Community: https://discord.com/invite/Pbv5PsqUSv
  - Mentions a YouTube embed reference: `@[youtube](0rtdVfjKJ-M)`
- **Edge cases:** none (non-executable).

#### Node: Sticky Note1
- **Type / role:** sticky note with an image.
- **Content:** `https://www.thesys.dev/n8n/n8n-compare.png`
- **Edge cases:** none.

#### Node: Sticky Note2
- **Type / role:** sticky note.
- **Content:** “UI Agent… reason, use tools and returns results as interactive UI”
- **Edge cases:** none.

#### Node: Sticky Note6
- **Type / role:** sticky note describing setup steps.
- **Content highlights:**
  - Step 1: Make chat public and copy Chat URL.
  - Step 2: Create Thesys API key, create OpenAI credential, set Base URL to `https://api.thesys.dev/v1/embed`, pick a model (example: `c1/openai/gpt-5/v20251230`).
  - Includes image: `https://www.thesys.dev/n8n/n8n-step-2.png`
- **Edge cases:** none (but it documents the most common misconfiguration: wrong base URL / missing key).

#### Node: Sticky Note8
- **Type / role:** sticky note for activation and testing.
- **Content highlights:**
  - Step 4: Activate workflow.
  - Step 5: Use https://www.thesys.dev/n8n and paste the Chat URL.
- **Edge cases:** none.

---

## 3. Summary Table

| Node Name | Node Type | Functional Role | Input Node(s) | Output Node(s) | Sticky Note |
|---|---|---|---|---|---|
| Sticky Note | n8n-nodes-base.stickyNote | Documentation: overview, setup, links |  |  | ## Conversational analytics with Google Sheet and C1 by Thesys … Demo link: https://www.thesys.dev/n8n?url=https%3A%2F%2Fasd2224.app.n8n.cloud%2Fwebhook%2Feb721104-ff1e-43f2-800d-000f04c1f427%2Fchat … API keys: https://console.thesys.dev/keys … Community: https://discord.com/invite/Pbv5PsqUSv … Email: support@thesys.dev … YouTube: @[youtube](0rtdVfjKJ-M) |
| Sticky Note1 | n8n-nodes-base.stickyNote | Documentation: image |  |  | ![](https://www.thesys.dev/n8n/n8n-compare.png) |
| When chat message received | @n8n/n8n-nodes-langchain.chatTrigger | Public chat entry point |  | UI Agent | ### Step 1: Enable Chat … (make public, copy Chat URL) |
| Sticky Note6 | n8n-nodes-base.stickyNote | Documentation: setup steps |  |  | ### Step 1: Enable Chat … ### Step 2: Setup Thesys … Base URL https://api.thesys.dev/v1/embed … model selection |
| UI Agent | @n8n/n8n-nodes-langchain.agent | Orchestrates reasoning + tools + UI response | When chat message received; C1 Chat Model (AI); Simple Memory (AI); Fetch data from Google Sheet (AI tool) | (Chat response) | ## UI Agent This agent can reason, use tools and returns results as interactive UI |
| C1 Chat Model | @n8n/n8n-nodes-langchain.lmChatOpenAi | LLM provider (Thesys C1 via OpenAI-compatible interface) |  | UI Agent (AI languageModel) | ### Step 2: Setup Thesys … Base URL https://api.thesys.dev/v1/embed … select model |
| Simple Memory | @n8n/n8n-nodes-langchain.memoryBufferWindow | Keeps recent conversation context |  | UI Agent (AI memory) |  |
| Fetch data from Google Sheet | n8n-nodes-base.googleSheetsTool | Tool for agent to read Google Sheets data |  | UI Agent (AI tool) |  |
| Sticky Note2 | n8n-nodes-base.stickyNote | Documentation: describes UI Agent |  |  | ## UI Agent This agent can reason, use tools and returns results as interactive UI |
| Sticky Note8 | n8n-nodes-base.stickyNote | Documentation: activation/testing steps |  |  | ### Step 4: Activate the Workflow … ### Step 5: Try It Out … https://www.thesys.dev/n8n |

> Note: Sticky notes are not “connected” in n8n. The table includes them as standalone nodes and repeats their content where it is clearly applicable (e.g., setup notes near the chat/model).

---

## 4. Reproducing the Workflow from Scratch

1. **Create a new workflow**
   - Name it: `talk-to-your-data` (or your preferred name).

2. **Add Chat Trigger**
   - Node type: **LangChain → Chat Trigger** (`When chat message received`)
   - Enable **Publicly available**.
   - Save the node and copy the generated **Chat URL** (you will use it in Thesys’ web page later).

3. **Add an Agent**
   - Node type: **LangChain → Agent**
   - Name it: `UI Agent`
   - In **Options**, enable **Streaming** (Enable Streaming = true).

4. **Connect Chat Trigger → Agent**
   - Connect `When chat message received` **(main output)** → `UI Agent` **(main input)**.

5. **Add Memory**
   - Node type: **LangChain → Memory → Buffer Window Memory**
   - Name it: `Simple Memory`
   - Keep defaults (or adjust window size if your node UI exposes it).
   - Connect `Simple Memory` → `UI Agent` using the **AI Memory** connection type.

6. **Create Thesys API Key**
   - Go to: https://console.thesys.dev/keys
   - Generate a key and store it securely.

7. **Add the Chat Model (Thesys C1)**
   - Node type: **LangChain → LLMs → OpenAI Chat Model** (node name: `C1 Chat Model`)
   - **Credential setup (important):**
     - Create a new **OpenAI API** credential.
     - Paste your **Thesys API key** as the API key.
     - Set **Base URL** to: `https://api.thesys.dev/v1/embed`
     - Save the credential.
   - In the model node, select a C1 model identifier (example from the workflow):
     - `c1/openai/gpt-5/v-20250930`
   - Connect `C1 Chat Model` → `UI Agent` using the **AI Language Model** connection type.

8. **Add Google Sheets Tool**
   - Node type: **Google Sheets → Google Sheets Tool**
   - Name it: `Fetch data from Google Sheet`
   - Create/choose **Google Sheets OAuth2** credentials (grant access to the Google account that can read the target spreadsheet).
   - Select:
     - **Document:** the spreadsheet you want to analyze
     - **Sheet/Tab:** the tab containing your data
   - Connect `Fetch data from Google Sheet` → `UI Agent` using the **AI Tool** connection type.

9. **(Optional) Add Sticky Notes**
   - Add sticky notes for internal documentation and paste any operational links (Thesys page, community, etc.).

10. **Activate and test**
   - Toggle workflow to **Active**.
   - Open: https://www.thesys.dev/n8n
   - Paste your **Chat URL** and send a prompt like:
     - “Which campaign has the highest conversion rate?”
     - “Show leads by region as a bar chart.”

**Expected behavior:** the agent may call the Google Sheets tool, then respond with a UI-schema-like output that the Thesys frontend renders into interactive components.

---

## 5. General Notes & Resources

| Note Content | Context or Link |
|---|---|
| Working demo link (template showcase) | https://www.thesys.dev/n8n?url=https%3A%2F%2Fasd2224.app.n8n.cloud%2Fwebhook%2Feb721104-ff1e-43f2-800d-000f04c1f427%2Fchat |
| Thesys API keys page | https://console.thesys.dev/keys |
| Thesys Community (Discord) | https://discord.com/invite/Pbv5PsqUSv |
| Support email | support@thesys.dev |
| Thesys N8N testing page (paste Chat URL) | https://www.thesys.dev/n8n |
| Visual asset | https://www.thesys.dev/n8n/n8n-compare.png |
| Setup screenshot | https://www.thesys.dev/n8n/n8n-step-2.png |
| Video reference in note | `@[youtube](0rtdVfjKJ-M)` |

If you want, share the schema format your frontend expects (or the Thesys GenUI conventions you’re using), and I can add a dedicated section describing the agent’s expected output contract and common UI-schema failure modes.
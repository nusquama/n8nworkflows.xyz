{"name":"Track calories and weight using AI and QuickChart","nodes":[{"id":"sticky-main","name":"Sticky Note Main","type":"n8n-nodes-base.stickyNote","position":[-480,240],"parameters":{"color":3,"width":500,"height":420,"content":"# AI Health Tracker\n\n## How it works\n1. **Input:** Enter your stats via the Form.\n2. **Analyze:** **Gemini** estimates calories from your meal description (text) and calculates your daily balance.\n3. **Log:** Saves the data to **Google Sheets**.\n4. **Visualize:** Fetches the last 7 days of history and generates a trend graph using **QuickChart**.\n5. **Report:** Emails you the summary and the graph.\n\n## Setup steps\n1. **Google Sheets:** Create a sheet with headers: `Date`, `Weight`, `Steps`, `Meals`, `Calories_In`, `Calories_Out`, `Balance`.\n2. **Credentials:** Connect Gemini, Google Sheets, and Gmail.\n3. **Config:** Open **\"1. Configuration\"** to set your Sheet ID and BMR."},"typeVersion":1},{"id":"sticky-config","name":"Sticky Note Config","type":"n8n-nodes-base.stickyNote","position":[20,240],"parameters":{"color":7,"width":380,"height":280,"content":"## 1. Config & Input\nSet your BMR (Basal Metabolic Rate) and Sheet ID here."},"typeVersion":1},{"id":"sticky-ai","name":"Sticky Note AI","type":"n8n-nodes-base.stickyNote","position":[420,240],"parameters":{"color":7,"width":460,"height":460,"content":"## 2. AI Analysis\nGemini calculates \"Calories In\" from text and \"Calories Out\" from steps."},"typeVersion":1},{"id":"sticky-db","name":"Sticky Note DB","type":"n8n-nodes-base.stickyNote","position":[900,240],"parameters":{"color":7,"width":680,"height":460,"content":"## 3. Database & Graph\nLogs today's data, fetches history, and draws a trend line."},"typeVersion":1},{"id":"sticky-email","name":"Sticky Note Email","type":"n8n-nodes-base.stickyNote","position":[1600,240],"parameters":{"color":7,"width":360,"height":460,"content":"## 4. Delivery\nSends the graph and advice to your email."},"typeVersion":1},{"id":"form-trigger","name":"Health Form","type":"n8n-nodes-base.formTrigger","position":[60,340],"webhookId":"health-tracker-webhook","parameters":{"options":{"buttonLabel":"Analyze & Log"},"formTitle":"Daily Health Log","formFields":{"values":[{"fieldType":"number","fieldLabel":"Weight (kg)","requiredField":true},{"fieldType":"number","fieldLabel":"Steps Today","requiredField":true},{"textarea":true,"fieldLabel":"Meals (Text description)","placeholder":"e.g., Toast for breakfast, Ramen for lunch...","requiredField":true},{"fieldType":"email","fieldLabel":"Your Email","requiredField":true}]},"formDescription":"Just type what you ate. AI does the math."},"typeVersion":2.3},{"id":"config","name":"Configuration","type":"n8n-nodes-base.set","position":[260,340],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"sheetId","type":"string","value":""},{"id":"id-2","name":"userBMR","type":"string","value":"1500"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"gemini-calc","name":"Gemini: Calc","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[480,340],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"models/gemini-1.5-flash","cachedResultName":"models/gemini-1.5-flash"},"options":{},"messages":{"values":[{"content":"=You are a nutritionist.\nCalculate daily calories.\n\n[Data]\n- Steps: {{ $('Health Form').first().json['Steps Today'] }}\n- Meals: {{ $('Health Form').first().json['Meals (Text description)'] }}\n- BMR: {{ $('Configuration').first().json.userBMR }}\n\n[Logic]\n1. Estimate \"Calories In\" from Meals. Be conservative.\n2. Calculate \"Calories Out\" = BMR + (Steps * 0.04).\n3. Balance = In - Out.\n\n[Output]\nJSON ONLY:\n{\n  \"calories_in\": 1234,\n  \"calories_out\": 2000,\n  \"balance\": -766,\n  \"advice\": \"Short advice sentence\"\n}"}]}},"credentials":{"googlePalmApi":{"id":"googlePalmApi","name":"Google Gemini(PaLM) Api account"}},"typeVersion":1},{"id":"parse-json","name":"Parse JSON","type":"n8n-nodes-base.code","position":[700,340],"parameters":{"jsCode":"// Parse AI Response with Safety Check\nconst text = $input.first().json.content.parts[0].text;\nlet data = {};\n\ntry {\n  const cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();\n  data = JSON.parse(cleanText);\n} catch (e) {\n  // Fallback if AI fails\n  data = { \n    calories_in: 0, \n    calories_out: 0, \n    balance: 0, \n    advice: \"Could not calculate details. Please check your input.\" \n  };\n}\n\nreturn { json: data };"},"typeVersion":2},{"id":"save-data","name":"Save Today","type":"n8n-nodes-base.googleSheets","position":[940,340],"parameters":{"columns":{"value":{"Date":"={{ $today.format('yyyy-MM-dd') }}","Meals":"={{ $('Health Form').first().json['Meals (Text description)'] }}","Steps":"={{ $('Health Form').first().json['Steps Today'] }}","Weight":"={{ $('Health Form').first().json['Weight (kg)'] }}","Balance":"={{ $json.balance }}","Calories_In":"={{ $json.calories_in }}","Calories_Out":"={{ $json.calories_out }}"},"mappingMode":"defineBelow"},"options":{},"operation":"appendOrUpdate","sheetName":{"__rl":true,"mode":"name","value":"HealthLog"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Configuration').first().json.sheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"googleSheetsOAuth2Api","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"get-history","name":"Get History","type":"n8n-nodes-base.googleSheets","position":[1160,340],"parameters":{"limit":7,"options":{"returnAllMatches":"returnAllMatches"},"sheetName":{"__rl":true,"mode":"name","value":"HealthLog"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Configuration').first().json.sheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"googleSheetsOAuth2Api","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"quickchart","name":"Generate Graph","type":"n8n-nodes-base.httpRequest","position":[1380,340],"parameters":{"url":"https://quickchart.io/chart","options":{},"sendQuery":true,"queryParameters":{"parameters":[{"name":"c","value":"={{ \n  JSON.stringify({\n    type: 'line',\n    data: {\n      labels: $('Get History').all().map(i => i.json.Date),\n      datasets: [{\n        label: 'Weight (kg)',\n        data: $('Get History').all().map(i => i.json.Weight),\n        borderColor: 'rgb(75, 192, 192)',\n        fill: false\n      }]\n    }\n  }) \n}}"}]}},"typeVersion":4.3},{"id":"send-email","name":"Send Email","type":"n8n-nodes-base.gmail","position":[1640,340],"parameters":{"sendTo":"={{ $('Health Form').first().json['Your Email'] }}","message":"=<h3>Daily Summary</h3>\n<p><strong>Weight:</strong> {{ $('Health Form').first().json['Weight (kg)'] }} kg</p>\n<p><strong>Steps:</strong> {{ $('Health Form').first().json['Steps Today'] }}</p>\n<hr>\n<h4>ðŸ”¥ Calories</h4>\n<p>In: {{ $('Parse JSON').first().json.calories_in }} | Out: {{ $('Parse JSON').first().json.calories_out }}</p>\n<p><strong>Balance: {{ $('Parse JSON').first().json.balance }} kcal</strong></p>\n<hr>\n<p><i>{{ $('Parse JSON').first().json.advice }}</i></p>\n<br>\n<img src=\"{{ $json.url }}\" width=\"400\" />","options":{},"subject":"ðŸ’ª Health Report: {{ $today.format('yyyy-MM-dd') }}","emailType":"html"},"credentials":{"gmailOAuth2":{"id":"gmailOAuth2","name":"Gmail account"}},"typeVersion":2.1}],"pinData":{},"connections":{"Parse JSON":{"main":[[{"node":"Save Today","type":"main","index":0}]]},"Save Today":{"main":[[{"node":"Get History","type":"main","index":0}]]},"Get History":{"main":[[{"node":"Generate Graph","type":"main","index":0}]]},"Health Form":{"main":[[{"node":"Configuration","type":"main","index":0}]]},"Gemini: Calc":{"main":[[{"node":"Parse JSON","type":"main","index":0}]]},"Configuration":{"main":[[{"node":"Gemini: Calc","type":"main","index":0}]]},"Generate Graph":{"main":[[{"node":"Send Email","type":"main","index":0}]]}}}
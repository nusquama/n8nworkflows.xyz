{"id":"PUNQuULXbu9EcXLU","meta":{"instanceId":"d6998d68d5ddde8bdb1a2d6a16f88f7d0cef5f647d1548b25f1adf37764062db","templateCredsSetupCompleted":true},"name":"Track LINE activity and AI sentiment for elderly care","tags":[],"nodes":[{"id":"ce257029-f593-4067-aa05-d888a645d516","name":"Sticky Note - Main","type":"n8n-nodes-base.stickyNote","position":[-3632,272],"parameters":{"width":500,"height":360,"content":"## ðŸ‘´ Elderly Care Monitor\n\nThis workflow helps families monitor elderly relatives using LINE and AI. It logs activity, detects distress via sentiment analysis, and automates daily check-ins.\n\n## How it works\n1. **Log & Analyze:** Logs every LINE message to **Google Sheets** and uses **Gemini** to analyze sentiment. If a health risk is detected, it alerts the family immediately.\n2. **Daily Check:** Runs every day at 11:00 AM to check for activity.\n3. **Remind:** If no messages have been sent today, it sends a gentle reminder to the parent.\n4. **Escalate:** If there is still no activity after 3 hours, it sends an emergency alert to the child.\n\n## Setup steps\n1. **LINE:** Set up a **Webhook** in LINE Developers console pointing to this workflow's Production URL.\n2. **Google Sheets:** Create a sheet with headers: `Date`, `Time`, `Message`, `Sentiment`, `Alert`.\n3. **Config:** Open the **\"Config\"** node below to set your `PARENT_LINE_ID`, `CHILD_LINE_ID`, and `SHEET_ID`."},"typeVersion":1},{"id":"6ddb6277-b6c0-486e-a04a-f52bb929b559","name":"Sticky Note - Config","type":"n8n-nodes-base.stickyNote","position":[-3136,688],"parameters":{"color":7,"width":416,"height":140,"content":"## âš™ï¸ Configuration\nSet User IDs here."},"typeVersion":1},{"id":"56946daa-4a66-404a-906b-29420116de65","name":"Sticky Note - Monitor","type":"n8n-nodes-base.stickyNote","position":[-2640,288],"parameters":{"color":7,"width":1104,"height":140,"content":"## ðŸ“¨ Real-time Monitoring\nLogs messages & detects risks."},"typeVersion":1},{"id":"9d395292-bacd-4ef5-bb85-d5149fdff703","name":"Sticky Note - Watchdog","type":"n8n-nodes-base.stickyNote","position":[-2576,688],"parameters":{"color":7,"width":1260,"height":140,"content":"## â° Daily Inactivity Check\nChecks logs & sends reminders if silent."},"typeVersion":1},{"id":"1b62fcda-5aa4-49c7-92b5-a92e0897a77e","name":"Config","type":"n8n-nodes-base.set","position":[-3120,752],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id_1","name":"PARENT_LINE_ID","type":"string","value":""},{"id":"id_2","name":"CHILD_LINE_ID","type":"string","value":""},{"id":"id_3","name":"SHEET_ID","type":"string","value":""}]}},"typeVersion":3.4},{"id":"74244e47-01c6-4469-a02b-40aac1c981de","name":"Format Message","type":"n8n-nodes-base.set","position":[-2624,352],"parameters":{"options":{},"assignments":{"assignments":[{"id":"msg","name":"userMessage","type":"string","value":"={{ $json.body.events[0].message.type === 'text' ? $json.body.events[0].message.text : '[Sent Media/Sticker]' }}"},{"id":"time","name":"timestamp","type":"string","value":"={{ $now.toISO() }}"}]}},"typeVersion":3.4},{"id":"216739ee-f073-4b4b-b1e5-02fa973c6e3b","name":"Gemini: Analyze","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[-2432,352],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"models/gemini-1.5-flash","cachedResultName":"models/gemini-1.5-flash"},"options":{},"messages":{"values":[{"content":"=Analyze this message: \"{{ $json.userMessage }}\"\n\nTask: Detect health risks (e.g., dizzy, pain). Stickers are Neutral.\n\nOutput JSON:\n{ \"sentiment\": \"Positive/Neutral/Negative\", \"health_risk\": true/false, \"summary\": \"Short summary\" }"}]}},"typeVersion":1},{"id":"3853f6e1-977b-4bba-aa38-82aad0641fdd","name":"Parse JSON","type":"n8n-nodes-base.code","position":[-2176,352],"parameters":{"jsCode":"// Simple JSON Parse\nconst text = $input.first().json.content.parts[0].text;\nlet data = {};\n\ntry {\n  const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    data = JSON.parse(jsonMatch[0]);\n  } else {\n    data = { sentiment: \"Neutral\", health_risk: false, summary: \"No text to analyze\" };\n  }\n} catch (e) {\n  data = { sentiment: \"Neutral\", health_risk: false, summary: \"Parse Error\" };\n}\n\nreturn { json: data };"},"typeVersion":2},{"id":"445d5ab0-b858-4ada-9a18-3815c22961e6","name":"Log to Sheets","type":"n8n-nodes-base.googleSheets","position":[-1968,352],"parameters":{"columns":{"value":{"Date":"={{ $today.format('yyyy-MM-dd') }}","Time":"={{ $now.format('HH:mm') }}","Alert":"={{ $json.health_risk ? 'YES' : 'NO' }}","Message":"={{ $('Format Message').first().json.userMessage }}","Sentiment":"={{ $json.sentiment }}"},"mappingMode":"defineBelow"},"options":{},"operation":"appendOrUpdate","sheetName":{"__rl":true,"mode":"name","value":"ActivityLog"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Config').first().json.SHEET_ID }}"}},"typeVersion":4.7},{"id":"159362d6-752b-498f-a0bd-5f084ef633bd","name":"Is Risk?","type":"n8n-nodes-base.if","position":[-1744,352],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"is_risk","operator":{"type":"boolean","operation":"true"},"leftValue":"={{ $json.health_risk }}","rightValue":true}]}},"typeVersion":2.2},{"id":"d1843452-d287-467e-9f86-138163c225de","name":"Alert Child","type":"n8n-nodes-base.line","position":[-1520,240],"parameters":{"resource":"message"},"typeVersion":1},{"id":"26d56aa7-7b2e-4a6e-a7fd-cfd430a2caa0","name":"Daily 11 AM","type":"n8n-nodes-base.scheduleTrigger","position":[-3008,752],"parameters":{"rule":{"interval":[{"triggerAtHour":11}]}},"typeVersion":1.2},{"id":"81116af1-5324-48e7-ac15-92bf6497e2d9","name":"Read Logs","type":"n8n-nodes-base.googleSheets","position":[-2624,752],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"name","value":"ActivityLog"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Config for Daily').first().json.SHEET_ID }}"}},"typeVersion":4.7,"alwaysOutputData":true},{"id":"1fa2ba8c-27ce-4ffd-a67f-502f39439fc6","name":"Check Activity","type":"n8n-nodes-base.code","position":[-2400,752],"parameters":{"jsCode":"// Check if there is any log for today\nconst logs = $input.all();\nconst today = new Date().toISOString().split('T')[0];\n\nconst hasActivity = logs.some(log => \n  log.json.Date && log.json.Date === today\n);\n\nreturn { json: { hasActivity } };"},"typeVersion":2},{"id":"99be4916-0ab5-43dc-a907-d8f1d4252115","name":"If Inactive","type":"n8n-nodes-base.if","position":[-2176,752],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"no_activity","operator":{"type":"boolean","operation":"true"},"leftValue":"={{ $json.hasActivity }}","rightValue":false}]}},"typeVersion":2.2},{"id":"fb9f3eee-14cb-4f1f-ac24-326ac71e7ca7","name":"Remind Parent","type":"n8n-nodes-base.line","position":[-1968,672],"parameters":{"resource":"message"},"typeVersion":1},{"id":"b6c2487d-21ab-4277-9e5d-25231ddf697b","name":"Wait 3 Hours","type":"n8n-nodes-base.wait","position":[-1744,672],"webhookId":"wait-webhook-generic","parameters":{"unit":"hours","amount":3},"typeVersion":1.1},{"id":"9e2715e3-ee92-4013-9dc5-b3ed64c80202","name":"Read Logs Again","type":"n8n-nodes-base.googleSheets","position":[-1520,672],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"name","value":"ActivityLog"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Config for Daily').first().json.SHEET_ID }}"}},"typeVersion":4.7,"alwaysOutputData":true},{"id":"e93b2e03-ebbf-4be8-b257-80d934facd0e","name":"Check Activity 2","type":"n8n-nodes-base.code","position":[-1296,672],"parameters":{"jsCode":"// Re-check for today\nconst logs = $input.all();\nconst today = new Date().toISOString().split('T')[0];\n\nconst hasActivity = logs.some(log => \n  log.json.Date && log.json.Date === today\n);\n\nreturn { json: { hasActivity } };"},"typeVersion":2},{"id":"102a8768-1308-4f79-bbcb-55665ba4a5e7","name":"If Still Inactive","type":"n8n-nodes-base.if","position":[-1088,672],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"still_inactive","operator":{"type":"boolean","operation":"true"},"leftValue":"={{ $json.hasActivity }}","rightValue":false}]}},"typeVersion":2.2},{"id":"efc80153-dc4b-464d-90ce-3ccbabc6f6b6","name":"Emergency Alert","type":"n8n-nodes-base.line","position":[-864,592],"parameters":{"resource":"message"},"typeVersion":1},{"id":"d93946b4-24b4-4de9-a389-f0043383d8dc","name":"LINE Webhook","type":"n8n-nodes-base.webhook","position":[-3296,752],"webhookId":"9e37dd05-51d7-4064-8d1b-c7ce995aaf07","parameters":{"path":"webhook","options":{},"httpMethod":"POST"},"typeVersion":1.1},{"id":"8f378821-62c3-43bc-b4b9-f8281070d6d6","name":"Config for Daily","type":"n8n-nodes-base.set","position":[-2848,752],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id_1","name":"PARENT_LINE_ID","type":"string","value":""},{"id":"id_2","name":"CHILD_LINE_ID","type":"string","value":""},{"id":"id_3","name":"SHEET_ID","type":"string","value":""}]}},"typeVersion":3.4}],"active":false,"pinData":{},"settings":{"availableInMCP":false,"executionOrder":"v1"},"versionId":"395d61c1-f4b7-474a-8d49-14210cba1967","connections":{"Config":{"main":[[{"node":"Format Message","type":"main","index":0}]]},"Is Risk?":{"main":[[{"node":"Alert Child","type":"main","index":0}]]},"Read Logs":{"main":[[{"node":"Check Activity","type":"main","index":0}]]},"Parse JSON":{"main":[[{"node":"Log to Sheets","type":"main","index":0}]]},"Daily 11 AM":{"main":[[{"node":"Config for Daily","type":"main","index":0}]]},"If Inactive":{"main":[[{"node":"Remind Parent","type":"main","index":0}]]},"LINE Webhook":{"main":[[{"node":"Config","type":"main","index":0}]]},"Wait 3 Hours":{"main":[[{"node":"Read Logs Again","type":"main","index":0}]]},"Log to Sheets":{"main":[[{"node":"Is Risk?","type":"main","index":0}]]},"Remind Parent":{"main":[[{"node":"Wait 3 Hours","type":"main","index":0}]]},"Check Activity":{"main":[[{"node":"If Inactive","type":"main","index":0}]]},"Format Message":{"main":[[{"node":"Gemini: Analyze","type":"main","index":0}]]},"Gemini: Analyze":{"main":[[{"node":"Parse JSON","type":"main","index":0}]]},"Read Logs Again":{"main":[[{"node":"Check Activity 2","type":"main","index":0}]]},"Check Activity 2":{"main":[[{"node":"If Still Inactive","type":"main","index":0}]]},"Config for Daily":{"main":[[{"node":"Read Logs","type":"main","index":0}]]},"If Still Inactive":{"main":[[{"node":"Emergency Alert","type":"main","index":0}]]}}}
{"id":"1oxL8KWiR9oECuT4","meta":{"instanceId":"d6998d68d5ddde8bdb1a2d6a16f88f7d0cef5f647d1548b25f1adf37764062db"},"name":"Generate recipe variations from ingredients using Google Gemini and Sheets","tags":[],"nodes":[{"id":"4f5ecf1b-4641-4c54-a280-78af1528fe1a","name":"Sticky Note Main","type":"n8n-nodes-base.stickyNote","position":[0,-80],"parameters":{"color":3,"width":460,"height":452,"content":"# Generate Recipe Variations\n\n## How it works\n1. **Input:** Enter your fridge leftovers via the Form.\n2. **AI Generation:** Google Gemini generates 3 distinct recipe styles (Speed, Healthy, Creative).\n3. **Visuals:** The workflow searches for a relevant image for each recipe using Google Custom Search.\n4. **Database:** Saves the recipe details to Google Sheets.\n5. **Delivery:** Aggregates the 3 options into a single email sent to you.\n\n## Setup steps\n1. **Google Sheets:** Create a sheet with headers: `date`, `ingredients`, `style`, `recipe_name`, `recipe_text`, `image_url`.\n2. **Credentials:** Set up credentials for Google Gemini, Custom Search, Sheets, and Gmail.\n3. **Configuration:** Open the **\"1. Configuration\"** node to enter your Spreadsheet ID, Search Engine ID, and API Key."},"typeVersion":1},{"id":"7b5d4a23-75bd-4fd9-860a-44cbb81d2081","name":"Sticky Note Config","type":"n8n-nodes-base.stickyNote","position":[512,-80],"parameters":{"color":7,"width":340,"height":396,"content":"## 1. Configuration\nAccepts user input and holds API settings."},"typeVersion":1},{"id":"41870563-dc2d-4427-97d4-ddbf0794719d","name":"Sticky Note AI","type":"n8n-nodes-base.stickyNote","position":[880,-80],"parameters":{"color":7,"width":460,"height":396,"content":"## 2. AI Processing\nGenerates 3 recipes and splits them for processing."},"typeVersion":1},{"id":"41192144-d298-40ce-86a3-ab6dc599450a","name":"Sticky Note Process","type":"n8n-nodes-base.stickyNote","position":[1392,-80],"parameters":{"color":7,"width":460,"height":396,"content":"## 3. Enrichment Loop\nFetches images and saves data for each recipe."},"typeVersion":1},{"id":"defcfbf7-0eb6-46b4-9f4b-53f77d9dc0af","name":"Sticky Note Delivery","type":"n8n-nodes-base.stickyNote","position":[1888,-80],"parameters":{"color":7,"width":460,"height":396,"content":"## 4. Delivery\nCombines results and sends an email."},"typeVersion":1},{"id":"b5b94bc5-d7b0-4a79-b1f9-1f91591b52c4","name":"Ingredient Form","type":"n8n-nodes-base.formTrigger","position":[544,80],"webhookId":"lazy-chef-webhook","parameters":{"options":{"buttonLabel":"Generate Recipes"},"formTitle":"Lazy Chef - Recipe Generator","formFields":{"values":[{"fieldLabel":"Ingredients","placeholder":"e.g., Eggs, Milk, Rice","requiredField":true},{"fieldLabel":"Current Mood","defaultValue":"Hungry!","requiredField":true},{"fieldType":"email","fieldLabel":"Your Email","requiredField":true}]},"formDescription":"Enter ingredients. AI will generate Speed, Healthy, and Creative recipes."},"typeVersion":2.3},{"id":"531e088b-cb8c-4296-aee5-3c1b3a81a889","name":"Configuration","type":"n8n-nodes-base.set","position":[704,80],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"sheetId","type":"string","value":"12345abcdef_placeholder_sheet_id"},{"id":"id-2","name":"googleSearchApiKey","type":"string","value":"AIzaSy_placeholder_api_key"},{"id":"id-3","name":"googleSearchEngineId","type":"string","value":"0123456789_placeholder_cx"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"8f0dcb47-a473-4f7c-a5b8-24380194f615","name":"Gemini: Generate Recipes","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[944,80],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"models/gemini-1.5-flash","cachedResultName":"models/gemini-1.5-flash"},"options":{},"messages":{"values":[{"content":"=You are a creative chef.\nGenerate 3 distinct recipe styles based on the user's ingredients. Output ONLY a JSON Array.\n\nStyles:\n1. Speed (5 min)\n2. Healthy (Low calorie)\n3. Creative (Unique)\n\n[User Info]\nIngredients: {{ $json['Ingredients'] }}\nMood: {{ $json['Current Mood'] }}\n\n[Output Format]\n[\n  {\n    \"style\": \"Speed\",\n    \"recipe_name\": \"Name\",\n    \"search_query\": \"Name (for image search)\",\n    \"recipe_text\": \"Instructions\"\n  },\n  ...\n]"}]}},"credentials":{"googlePalmApi":{"id":"uNBp7Mo2n5MpE8Mb","name":"Google Gemini(PaLM) Api account"}},"typeVersion":1},{"id":"63bb1190-620f-492e-93e9-9f14711fcd88","name":"Split into Items","type":"n8n-nodes-base.code","position":[1200,80],"parameters":{"jsCode":"// Parse Gemini output into 3 items\nconst text = $input.first().json.content.parts[0].text;\nlet recipes = [];\n\ntry {\n  const cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();\n  recipes = JSON.parse(cleanText);\n} catch (e) {\n  recipes = [{ \n    style: \"Error\", \n    recipe_name: \"Error\", \n    search_query: \"Error\", \n    recipe_text: \"Failed to parse AI output.\" \n  }];\n}\n\nreturn recipes;"},"typeVersion":2},{"id":"0a2ec4e3-9c70-4f4a-b67b-ea3786493aa9","name":"Google Image Search","type":"n8n-nodes-base.httpRequest","position":[1440,0],"parameters":{"url":"https://www.googleapis.com/customsearch/v1","options":{},"sendQuery":true,"queryParameters":{"parameters":[{"name":"q","value":"={{ $json.search_query }}"},{"name":"cx","value":"={{ $('Configuration').first().json.googleSearchEngineId }}"},{"name":"key","value":"={{ $('Configuration').first().json.googleSearchApiKey }}"},{"name":"searchType","value":"image"},{"name":"num","value":"1"}]}},"typeVersion":4.3},{"id":"b1a5295b-7713-4bcd-a274-874a6cd0dce0","name":"Save to Google Sheets","type":"n8n-nodes-base.googleSheets","position":[1648,160],"parameters":{"columns":{"value":{"date":"={{ $now.format('yyyy-MM-dd HH:mm') }}","style":"={{ $json.style }}","image_url":"={{ $('Google Image Search').item.json.items[0].link }}","ingredients":"={{ $('Ingredient Form').first().json['Ingredients'] }}","recipe_name":"={{ $json.recipe_name }}","recipe_text":"={{ $json.recipe_text }}"},"mappingMode":"defineBelow"},"options":{},"operation":"appendOrUpdate","sheetName":{"__rl":true,"mode":"name","value":"Recipes"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Configuration').first().json.sheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"kETRjtRKedfCcNUZ","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"8707f13b-ede7-4f0d-b8cc-b3b5c049e1a7","name":"Aggregate to HTML","type":"n8n-nodes-base.code","position":[1952,80],"parameters":{"jsCode":"// Aggregate the 3 items back into one email\nconst items = $input.all();\nlet htmlContent = \"<h2>üç≥ Your 3 Recipe Options</h2><hr>\";\n\nitems.forEach(item => {\n  const data = item.json;\n  const imgUrl = item.json.image_url || \"\";\n  \n  htmlContent += `\n    <div style='margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px;'>\n      <h3 style='color: #d35400;'>${data.style}: ${data.recipe_name}</h3>\n      <img src='${imgUrl}' width='200' style='border-radius:5px; display:block; margin-bottom:10px;'>\n      <p><strong>Instructions:</strong> ${data.recipe_text}</p>\n    </div>\n  `;\n});\n\nreturn { \n  json: { \n    emailBody: htmlContent, \n    recipient: $('Ingredient Form').first().json[\"Your Email\"] \n  } \n};"},"typeVersion":2},{"id":"ae6d4182-1f99-41d0-a535-3d6fc0c35d95","name":"Send Email","type":"n8n-nodes-base.gmail","position":[2144,80],"webhookId":"c6e004e8-4c19-41ca-8c18-370bf859e90c","parameters":{"sendTo":"={{ $json.recipient }}","message":"={{ $json.emailBody }}","options":{},"subject":"üç≥ Your 3 Recipe Proposals","emailType":"text"},"credentials":{"gmailOAuth2":{"id":"qVmR1ytFIlpRVwxW","name":"Gmail account"}},"typeVersion":2.1}],"active":false,"pinData":{},"settings":{"availableInMCP":false,"executionOrder":"v1"},"versionId":"d951744d-b5ca-443b-bbd8-96a376ee6977","connections":{"Configuration":{"main":[[{"node":"Gemini: Generate Recipes","type":"main","index":0}]]},"Ingredient Form":{"main":[[{"node":"Configuration","type":"main","index":0}]]},"Split into Items":{"main":[[{"node":"Google Image Search","type":"main","index":0},{"node":"Save to Google Sheets","type":"main","index":0}]]},"Aggregate to HTML":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"Google Image Search":{"main":[[{"node":"Save to Google Sheets","type":"main","index":0}]]},"Save to Google Sheets":{"main":[[{"node":"Aggregate to HTML","type":"main","index":0}]]},"Gemini: Generate Recipes":{"main":[[{"node":"Split into Items","type":"main","index":0}]]}}}